<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Medical Store - Surat</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Custom Styles -->
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: #f8fafc; }
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.3s ease-out; }
        .btn-glow { transition: all 0.3s ease; box-shadow: 0 4px 15px 0 rgba(13, 148, 136, 0.3); }
        .btn-glow:hover { box-shadow: 0 6px 25px 0 rgba(13, 148, 136, 0.4); transform: translateY(-2px); }
        .card-hover-effect { transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; border: 1px solid #e5e7eb; }
        .card-hover-effect:hover { transform: translateY(-5px); box-shadow: 0 10px 20px -5px rgb(0 0 0 / 0.08); border-color: #0d9488; }
        .mobile-menu { transition: transform 0.3s ease-in-out; }
        
        @keyframes shimmer { 100% { transform: translateX(100%); } }
        .shimmer-bg { position: relative; overflow: hidden; background-color: #e5e7eb; }
        .shimmer-bg::after { position: absolute; top: 0; right: 0; bottom: 0; left: 0; transform: translateX(-100%); background-image: linear-gradient(90deg, #e5e7eb 0, #f3f4f6 20%, #f3f4f6 60%, #e5e7eb 100%); animation: shimmer 1.5s infinite; content: ''; }
        
        @keyframes marquee {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-50%); }
        }
        .animate-marquee {
            animation: marquee 40s linear infinite;
        }
        .animate-marquee:hover {
            animation-play-state: paused;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateY(8px); }
            10%, 90% { opacity: 1; transform: translateY(0); }
        }
        .trending-text { animation: fadeInOut 3s ease-in-out infinite; }
    </style>
</head>
<body class="text-gray-800">

    <!-- UPDATED Navigation Bar -->
    <nav class="bg-white/90 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
        <div class="w-full px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <a href="#" class="flex items-center gap-2">
                    <i class="fa-solid fa-heart-pulse text-2xl text-teal-600"></i>
                    <span class="font-bold text-xl text-teal-800">Lucky Medical</span>
                </a>
                <div class="hidden lg:flex items-center space-x-8">
                    <a href="#home" class="text-gray-600 hover:text-teal-600 font-medium">Home</a>
                    <a href="#medicines-section" class="text-gray-600 hover:text-teal-600 font-medium">Products</a>
                    <a href="#booking-section" class="bg-teal-600 text-white font-bold py-2 px-5 rounded-full hover:bg-teal-700 transition btn-glow">Order Now</a>
                </div>
                <div class="lg:hidden">
                    <button id="hamburger-btn" class="text-gray-700 focus:outline-none">
                        <i class="fa-solid fa-bars fa-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="lg:hidden hidden mobile-menu bg-white border-t border-gray-200">
            <a href="#home" class="block py-3 px-4 text-gray-600 hover:bg-teal-50">Home</a>
            <a href="#medicines-section" class="block py-3 px-4 text-gray-600 hover:bg-teal-50">Products</a>
            <a href="#booking-section" class="block py-3 px-4 bg-teal-50 font-semibold text-teal-700">Order Now</a>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <header id="home" class="relative bg-gray-800">
        <div class="absolute inset-0">
            <img src="https://images.unsplash.com/photo-1584308666744-24d5c474f2ae?q=80&w=2070&auto=format&fit=crop" class="w-full h-full object-cover opacity-20" alt="Pharmacy Background">
        </div>
        <div class="relative container mx-auto px-4 py-16 md:py-24 text-center text-white">
            <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">Lucky Medical Store</h1>
            <p class="text-teal-200 mt-6 text-lg max-w-2xl mx-auto">Your trusted pharmacy in Surat. Fast, reliable, and right at your doorstep.</p>
            <div class="mt-10 flex justify-center gap-4 flex-wrap">
                 <a href="#booking-section" class="inline-block bg-teal-500 text-white font-bold py-3 px-8 rounded-full hover:bg-teal-600 transition duration-300 transform hover:scale-105 shadow-lg"><i class="fa-solid fa-pills mr-2"></i>Order Now</a>
                 <a href="#medicines-section" class="inline-block bg-white/20 backdrop-blur-sm text-white font-bold py-3 px-8 rounded-full hover:bg-white/30 transition duration-300">Browse Products</a>
            </div>
        </div>
    </header>


    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- AVAILABLE MEDICINES SECTION -->
        <section id="medicines-section" class="my-16">
            <div class="text-center mb-10"><h2 class="text-3xl font-bold text-gray-800">Find Your Medicines</h2><p class="text-gray-500 mt-1">Search for a product or explore our top picks below.</p><div class="max-w-xl mx-auto mt-6"><div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-4"><i class="fa-solid fa-magnifying-glass text-gray-400"></i></span><input type="text" id="search-bar" placeholder="e.g. 'Dolo 650' or 'Cough Syrup'" class="w-full p-4 pl-12 border border-gray-300 rounded-full focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"></div></div></div>
            
            <div id="initial-prompt" class="max-w-6xl mx-auto hidden">
                 <h3 class="text-2xl font-bold text-gray-800 text-center mb-6">Top Picks For You</h3>
                 <div class="w-full overflow-hidden group"><div id="scrolling-banners" class="flex animate-marquee group-hover:paused"></div></div>
                 <div class="text-center bg-white p-4 rounded-lg shadow-sm border mt-8">
                    <span class="font-semibold text-gray-600 mr-2">Users Also Search:</span>
                    <span class="inline-block text-teal-600 font-bold text-lg"><span id="trending-text" class="trending-text"></span></span>
                 </div>
            </div>

            <div id="shimmer-container" class="max-w-6xl mx-auto"></div>
            <div id="medicine-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 hidden"></div>
            <p id="no-results" class="text-center text-gray-500 mt-8 hidden">No medicines found matching your search.</p>
        </section>

        <!-- BOOKING FORM SECTION -->
        <section id="booking-section" class="my-16 max-w-2xl mx-auto bg-white p-8 md:p-10 rounded-2xl shadow-xl border border-gray-100">
            <h2 class="text-3xl font-bold mb-6 text-center">Place Your Order</h2>
            <form id="booking-form" action="https://formspree.io/f/mjkrrbnb" method="POST" class="space-y-6">
                 <div><label for="medicine-select" class="block text-sm font-medium text-gray-700 mb-1">Selected Medicine</label><select id="medicine-select" name="Medicine" class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition" disabled><option value="">-- Search and select a product --</option></select></div>
                
                <div id="price-section" class="bg-gray-50 p-4 rounded-lg hidden">
                    <div class="flex justify-between items-center text-gray-700"><span>Price:</span><span id="price-display"></span></div>
                    <div id="discount-row" class="flex justify-between items-center text-green-600 font-semibold hidden"><span>Discount (15%):</span><span id="discount-display"></span></div>
                    <hr class="my-2 border-t border-gray-200">
                    <div class="flex justify-between items-center font-bold text-lg"><span>Total:</span><span id="total-display"></span></div>
                </div>

                 <div>
                    <a href="#" id="show-coupon-btn" class="text-sm font-semibold text-teal-600 hover:underline">Have a coupon code?</a>
                    <div id="coupon-section" class="flex gap-2 mt-2 hidden">
                        <input type="text" id="coupon-input" placeholder="Enter code" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500">
                        <button type="button" id="apply-coupon-btn" class="bg-gray-700 text-white font-bold px-5 rounded-lg hover:bg-gray-800">Apply</button>
                    </div>
                     <p id="coupon-status" class="text-sm mt-1"></p>
                </div>
                 
                <div><label for="name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label><input type="text" id="name" name="Customer Name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" placeholder="e.g., Aditya Saroj"></div>
                <div><label for="whatsapp" class="block text-sm font-medium text-gray-700 mb-1">WhatsApp Number</label><input type="tel" id="whatsapp" name="WhatsApp Number" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" placeholder="e.g., 9876543210"></div>
                <div><label for="address" class="block text-sm font-medium text-gray-700 mb-1">Full Delivery Address</label><textarea id="address" name="Delivery Address" rows="3" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" placeholder="B-11 SAI DARSHAN RESIDENCY..."></textarea></div>
                <input type="hidden" id="location-coords" name="GPS Location">
                <div><button type="button" id="get-location-btn" class="w-full flex items-center justify-center gap-3 p-3 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-50 transition text-gray-600 font-semibold"><i class="fa-solid fa-location-crosshairs text-teal-500"></i> Add Accurate GPS Location (Optional)</button><p id="location-status" class="text-sm text-center mt-2 text-gray-500"></p></div>
                <div class="pt-4"><button type="submit" class="w-full bg-teal-600 text-white font-bold py-4 px-4 rounded-lg focus:outline-none focus:ring-4 focus:ring-teal-500 focus:ring-opacity-50 flex items-center justify-center gap-3 btn-glow"><i class="fa-regular fa-paper-plane"></i> Confirm & Place Order</button></div>
                 <input type="hidden" name="Original Price" id="hidden-original-price">
                 <input type="hidden" name="Discount Applied" id="hidden-discount-applied">
                 <input type="hidden" name="Final Price" id="hidden-final-price">
            </form>
        </section>
    </main>
    
    <!-- FOOTER -->
    <footer class="bg-gray-800 text-white mt-20">
        <div class="container mx-auto py-10 px-4 text-center"><p class="font-bold text-lg">Lucky Medical Store</p><p class="text-gray-400 mt-2">B-11 SAI DRASHAN RESIDENCY, OPP. UMA PLAZA, KHARWASA ROAD, DINDOLI, SURAT</p><p class="text-gray-400 mt-2">For inquiries, email: <a href="mailto:radhanasaroj7@gmail.com" class="text-teal-400 hover:underline">radhanasaroj7@gmail.com</a></p><div class="mt-4 text-gray-500 text-sm">&copy; <span id="year"></span> Lucky Medical Store by Aditya Saroj. All Rights Reserved.</div></div>
    </footer>
    
    <!-- MODALS -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-enter z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full text-center"><div id="modal-icon" class="mb-4"></div><h3 id="modal-title" class="text-xl font-bold mb-3"></h3><p id="modal-message" class="text-gray-600 mb-6 whitespace-pre-line"></p><button id="modal-close" class="w-full bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition">OK</button></div>
    </div>
    <div id="promo-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden modal-enter z-50">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full relative overflow-hidden">
            <button id="promo-close-btn" class="absolute top-4 right-4 text-gray-600 bg-white/50 hover:bg-white/80 rounded-full w-8 h-8 flex items-center justify-center transition z-20"><i class="fa-solid fa-times"></i></button>
            <div class="grid md:grid-cols-2 items-center">
                <div class="p-8"><h3 class="font-extrabold text-2xl text-teal-600">Welcome!</h3><p class="mt-2 text-gray-600">Get <span class="font-bold text-teal-700">15% OFF</span> your first order. Use code <span class="font-bold bg-teal-100 text-teal-800 px-2 py-1 rounded">LUCKY15</span>.</p><a href="#booking-section" id="promo-shop-now" class="mt-6 inline-block w-full text-center bg-teal-600 text-white font-bold py-3 px-6 rounded-lg btn-glow">Shop Now</a></div>
                <div class="hidden md:block h-full"><img src="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?q=80&w=2070&auto=format&fit=crop" class="w-full h-full object-cover" alt="Doctor"></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', async function() {
        
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-MH4nLsEaIH3oXpTKKI1LEYsOpzP2MXMgtKkdfnKPM8OBuEZEExSwpJGQc9BAM5Xl3w6uDTjWh-oU/pub?gid=0&single=true&output=csv';
        const COUPON_CODE = 'LUCKY15';
        
        const featuredProducts = [
            { name: "D-Fresh", image: "https://gargagencypharma.com/wp-content/uploads/2024/09/63.-D-FRESH-MR-TAB-10TAB-600x500-1.jpg", bgColor: "from-teal-600 to-teal-800" },
            { name: "Revital H", image: "https://cdn01.pharmeasy.in/dam/products_otc/270551/revital-h-men-multivitamin-with-zinc-ginseng-for-immunity-strong-bones-energy-10-capsules-6.1-1729854670.jpg", bgColor: "from-indigo-700 to-indigo-900" },
            { name: "Doliprane", image: "https://moncoinsante.com/mcs/65586-large_default/dolipranetabs-1000mg-adults-pain-fever-sanofi-8-coated-tablets.jpg", bgColor: "from-rose-700 to-rose-900" },
            { name: "Volini", image: "https://m.media-amazon.com/images/I/711NuU+tsvL.jpg", bgColor: "from-amber-600 to-amber-800" }
        ];

        let allMedicines = [];
        let currentPrice = 0;
        let discountApplied = false;
        let trendingInterval;

        // --- All element selectors ---
        const searchBar = document.getElementById('search-bar');
        const medicineSelect = document.getElementById('medicine-select');
        const medicineGrid = document.getElementById('medicine-grid');
        const noResultsMsg = document.getElementById('no-results');
        const initialPrompt = document.getElementById('initial-prompt');
        const shimmerContainer = document.getElementById('shimmer-container');
        const scrollingBannersContainer = document.getElementById('scrolling-banners');
        const trendingTextElement = document.getElementById('trending-text');
        const promoModal = document.getElementById('promo-modal');
        const promoCloseBtn = document.getElementById('promo-close-btn');
        const promoShopNowBtn = document.getElementById('promo-shop-now');

        function createShimmerCards() {
            shimmerContainer.innerHTML = '';
            initialPrompt.classList.add('hidden');
            const banners = document.createElement('div');
            banners.className = 'grid grid-cols-1 md:grid-cols-2 gap-6 mb-8';
            banners.innerHTML = `<div class="shimmer-bg h-48 rounded-xl"></div><div class="shimmer-bg h-48 rounded-xl"></div>`;
            shimmerContainer.appendChild(banners);
            const shimmerGrid = document.createElement('div');
            shimmerGrid.className = 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6';
            for(let i = 0; i < 8; i++) {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl overflow-hidden';
                card.innerHTML = `<div class="shimmer-bg w-full h-48"></div><div class="p-4"><div class="shimmer-bg h-6 w-3/4 rounded mb-2"></div><div class="shimmer-bg h-8 w-1/2 rounded"></div></div>`;
                shimmerGrid.appendChild(card);
            }
            shimmerContainer.appendChild(shimmerGrid);
        }

        async function loadMedicinesFromSheet() {
            if (GOOGLE_SHEET_URL === 'YOUR_GOOGLE_SHEET_PUBLISHED_CSV_URL_HERE') {
                shimmerContainer.classList.add('hidden');
                initialPrompt.innerHTML = '<div class="text-center"><i class="fa-solid fa-triangle-exclamation fa-3x mb-4 text-red-500"></i><p>Website not configured.</p></div>';
                initialPrompt.classList.remove('hidden');
                return;
            }
            try {
                const response = await fetch(GOOGLE_SHEET_URL);
                if (!response.ok) throw new Error('Network response not ok.');
                const csvText = await response.text();
                
                const rows = csvText.split(/\r?\n/).slice(1);
                allMedicines = rows.map(row => {
                    const columns = row.split(',');
                    return { name: columns[0] ? columns[0].trim() : '', price: columns[1] ? columns[1].trim() : '', image: columns[2] ? columns[2].trim() : '' };
                }).filter(med => med.name);

                shimmerContainer.classList.add('hidden');
                initialPrompt.classList.remove('hidden');
                populateMedicineSelect();
                startTrendingAnimation();
                
                if (!sessionStorage.getItem('promoShown')) {
                    setTimeout(() => {
                        promoModal.classList.remove('hidden');
                        promoModal.classList.add('modal-enter-active');
                        sessionStorage.setItem('promoShown', 'true');
                    }, 3000);
                }

            } catch (error) {
                console.error('Error fetching or parsing sheet data:', error);
                shimmerContainer.classList.add('hidden');
                initialPrompt.innerHTML = '<div class="text-center"><i class="fa-solid fa-circle-exclamation fa-3x mb-4 text-red-500"></i><p>Could not load product inventory.<br>Please check the Google Sheet URL.</p></div>';
                initialPrompt.classList.remove('hidden');
            }
        }
        
        function renderMedicineCards(medsToDisplay) {
            medicineGrid.innerHTML = ''; 
            medsToDisplay.forEach(med => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-2xl text-center card-hover-effect overflow-hidden flex flex-col';
                card.innerHTML = `<img src="${med.image}" alt="${med.name}" class="w-full h-40 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/300x300/cccccc/ffffff?text=Image+Not+Found';"><div class="p-4 flex flex-col flex-grow"><p class="font-bold text-md text-gray-800 flex-grow">${med.name}</p><p class="font-semibold text-lg text-gray-700 mt-2">${med.price}</p></div><button class="select-btn w-full bg-teal-50 text-teal-700 font-bold py-3 hover:bg-teal-100 transition" data-name="${med.name}">Select</button>`;
                medicineGrid.appendChild(card);
            });
            document.querySelectorAll('.select-btn').forEach(btn => btn.addEventListener('click', (e) => {
                const medName = e.target.dataset.name;
                medicineSelect.value = medName;
                updatePriceDetails();
                document.getElementById('booking-section').scrollIntoView();
            }));
        }

        function filterAndRender() {
            const query = searchBar.value.toLowerCase().trim();
            initialPrompt.classList.add('hidden');
            if (query.length === 0) {
                medicineGrid.classList.add('hidden');
                noResultsMsg.classList.add('hidden');
                if (allMedicines.length > 0) initialPrompt.classList.remove('hidden');
                return;
            }
            const filteredMeds = allMedicines.filter(med => med.name.toLowerCase().includes(query));
            if (filteredMeds.length > 0) {
                medicineGrid.classList.remove('hidden');
                noResultsMsg.classList.add('hidden');
                renderMedicineCards(filteredMeds);
            } else {
                medicineGrid.classList.add('hidden');
                noResultsMsg.classList.remove('hidden');
            }
        }

        function updatePriceDetails() {
            const selectedMedName = medicineSelect.value;
            const selectedMed = allMedicines.find(m => m.name === selectedMedName);
            const priceSection = document.getElementById('price-section');

            if (!selectedMed || !selectedMed.price) {
                priceSection.classList.add('hidden');
                return;
            }
            
            priceSection.classList.remove('hidden');
            const priceText = selectedMed.price.replace(/[^\d.-]/g, '');
            currentPrice = parseFloat(priceText);
            
            discountApplied = false;
            document.getElementById('coupon-input').value = '';
            document.getElementById('coupon-status').textContent = '';
            document.getElementById('discount-row').classList.add('hidden');
            
            updateDisplayAndHiddenInputs();
        }
        
        function updateDisplayAndHiddenInputs() {
            let discountAmount = 0;
            if (discountApplied) {
                discountAmount = currentPrice * 0.15;
                document.getElementById('discount-row').classList.remove('hidden');
                document.getElementById('discount-display').textContent = `- ₹${discountAmount.toFixed(2)}`;
            } else {
                 document.getElementById('discount-row').classList.add('hidden');
            }
            const finalPrice = currentPrice - discountAmount;

            document.getElementById('price-display').textContent = `₹${currentPrice.toFixed(2)}`;
            document.getElementById('total-display').textContent = `₹${finalPrice.toFixed(2)}`;
            
            document.getElementById('hidden-original-price').value = `₹${currentPrice.toFixed(2)}`;
            document.getElementById('hidden-discount-applied').value = discountApplied ? `Yes (15% - ₹${discountAmount.toFixed(2)})` : 'No';
            document.getElementById('hidden-final-price').value = `₹${finalPrice.toFixed(2)}`;
        }

        function applyCoupon() {
            const couponInput = document.getElementById('coupon-input');
            const couponStatus = document.getElementById('coupon-status');
            
            if (couponInput.value.trim().toUpperCase() === COUPON_CODE) {
                discountApplied = true;
                couponStatus.textContent = 'Coupon applied successfully!';
                couponStatus.className = 'text-sm mt-1 text-green-600';
            } else {
                discountApplied = false;
                couponStatus.textContent = 'Invalid coupon code.';
                couponStatus.className = 'text-sm mt-1 text-red-600';
            }
            updateDisplayAndHiddenInputs();
        }

        function populateScrollingBanners() {
            scrollingBannersContainer.innerHTML = '';
            const bannerItems = [...featuredProducts, ...featuredProducts];
            bannerItems.forEach(product => {
                const banner = document.createElement('div');
                banner.className = `flex-shrink-0 w-1/2 md:w-1/4 p-3`;
                banner.innerHTML = `<div class="banner-card bg-gradient-to-br ${product.bgColor} rounded-xl p-6 text-white cursor-pointer relative overflow-hidden flex flex-col justify-end h-48"><img src="${product.image}" class="absolute top-0 left-0 w-full h-full object-contain" alt="" onerror="this.style.display='none'"><div class="absolute inset-0 bg-black/30"></div><span class="text-lg font-bold relative z-10 self-start bg-white/20 px-4 py-2 rounded-full backdrop-blur-sm">Shop Now</span></div>`;
                banner.addEventListener('click', () => {
                    searchBar.value = product.name;
                    filterAndRender();
                });
                scrollingBannersContainer.appendChild(banner);
            });
        }
        
        function startTrendingAnimation() {
            if (trendingInterval) clearInterval(trendingInterval);
            if(allMedicines.length === 0) {
                trendingTextElement.textContent = "No products found.";
                return;
            };
            let currentIndex = 0;
            trendingTextElement.textContent = allMedicines[currentIndex].name;
            trendingInterval = setInterval(() => {
                currentIndex = (currentIndex + 1) % allMedicines.length;
                trendingTextElement.style.animation = 'none';
                void trendingTextElement.offsetWidth;
                trendingTextElement.style.animation = null; 
                trendingTextElement.textContent = allMedicines[currentIndex].name;
            }, 3000);
        }

        function populateMedicineSelect() {
            medicineSelect.innerHTML = '<option value="">-- Search and select a product --</option>';
            allMedicines.forEach(med => {
                const option = document.createElement('option');
                option.value = med.name;
                option.textContent = `${med.name} (${med.price})`;
                medicineSelect.appendChild(option);
            });
            medicineSelect.disabled = false;
        }

        function showModal(title, message, iconHTML = '') {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalIcon = document.getElementById('modal-icon');
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalIcon.innerHTML = iconHTML;
            modal.classList.remove('hidden');
            requestAnimationFrame(() => { modal.classList.add('modal-enter-active'); });
        }
        
        async function handleBookingSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const data = new FormData(form);
            if (!data.get('Medicine') || !data.get('Customer Name') || !data.get('Delivery Address') || !data.get('WhatsApp Number')) {
                showModal("Missing Information", "Please fill out all required fields, including your WhatsApp number.", '<i class="fa-solid fa-circle-exclamation text-yellow-500 fa-3x"></i>'); return;
            }
            try {
                const response = await fetch(form.action, { method: form.method, body: data, headers: { 'Accept': 'application/json' }});
                if (response.ok) {
                    showModal("Order Placed Successfully!", "Thank you for your order. We have received it and will contact you on WhatsApp shortly.", '<i class="fa-solid fa-circle-check text-green-500 fa-3x"></i>');
                    form.reset();
                    document.getElementById('location-status').textContent = "";
                    document.getElementById('price-section').classList.add('hidden');
                } else {
                    showModal("Submission Error", "Could not send order. Please try again later.", '<i class="fa-solid fa-circle-exclamation text-red-500 fa-3x"></i>');
                }
            } catch (error) {
                showModal("Network Error", "Could not send order. Please check your internet connection.", '<i class="fa-solid fa-wifi text-red-500 fa-3x"></i>');
            }
        }

        // --- Event Listeners & Initialization ---
        document.getElementById('hamburger-btn').addEventListener('click', () => document.getElementById('mobile-menu').classList.toggle('hidden'));
        document.querySelectorAll('#mobile-menu a').forEach(link => link.addEventListener('click', () => document.getElementById('mobile-menu').classList.add('hidden')));
        searchBar.addEventListener('input', filterAndRender);
        document.getElementById('get-location-btn').addEventListener('click', () => { /* Location logic */ });
        document.getElementById('booking-form').addEventListener('submit', handleBookingSubmit);
        document.getElementById('modal-close').addEventListener('click', () => document.getElementById('modal').classList.add('hidden'));

        promoCloseBtn.addEventListener('click', () => {
            promoModal.classList.remove('modal-enter-active');
            promoModal.classList.add('hidden');
        });
        promoShopNowBtn.addEventListener('click', () => {
            promoModal.classList.remove('modal-enter-active');
            promoModal.classList.add('hidden');
        });
        
        document.getElementById('show-coupon-btn').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('coupon-section').classList.toggle('hidden');
        });
        document.getElementById('apply-coupon-btn').addEventListener('click', applyCoupon);
        
        document.getElementById('year').textContent = new Date().getFullYear();
        createShimmerCards();
        loadMedicinesFromSheet();
        populateScrollingBanners();
    });
    </script>
</body>
</html>
